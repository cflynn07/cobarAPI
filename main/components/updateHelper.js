// Generated by CoffeeScript 1.6.3
(function() {
  var ORM, async, config, sequelize, _;

  _ = require('underscore');

  async = require('async');

  config = require(GLOBAL.appRoot + 'config/config');

  ORM = require(GLOBAL.appRoot + 'components/oRM');

  sequelize = ORM.setup();

  module.exports = function(resource, objects, req, res, app) {
    return async.map(objects, function(item, callback) {
      var followThrough;
      followThrough = function() {
        return resource.find({
          where: {
            uid: item.uid
          }
        }).success(function(resultResource) {
          var err;
          if (resultResource) {
            try {
              return resultResource.updateAttributes(item).success(function() {
                config.apiBroadcastPut(resource, resultResource, app, req, res);
                return callback();
              });
            } catch (_error) {
              err = _error;
              return callback();
            }
          } else {
            return callback();
          }
        });
      };
      if (_.isNull(item.deletedAt)) {
        return resource.find({
          where: {
            uid: item.uid
          }
        }).success(function(resultResource) {
          return sequelize.query("UPDATE `" + resource.tableName + "` SET `deletedAt` = NULL WHERE `id` = " + resultResource.id).success(function(result) {
            return followThrough();
          });
        });
      } else {
        return followThrough();
      }
    }, function() {
      return res.jsonAPIRespond(config.response(202));
    });
  };

}).call(this);
