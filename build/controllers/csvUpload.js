// Generated by CoffeeScript 1.6.3
(function() {
  var async, config, csv, fs;

  async = require('async');

  config = require('../config/config');

  csv = require('csv');

  fs = require('fs');

  module.exports = function(app) {
    return app.post('/csv-upload', function(req, res, next) {
      var file, outputArray;
      outputArray = [];
      file = req.files.files[0];
      try {
        return csv().from.stream(fs.createReadStream(file.path)).to.path('/tmp/tmpcsv' + Date.now()).transform(function(row) {
          return row;
        }).on('record', function(row, index) {
          return outputArray.push(row);
        }).on('end', function(count) {
          return res.end(JSON.stringify(outputArray));
        });
      } catch (_error) {}
    });
  };

}).call(this);
